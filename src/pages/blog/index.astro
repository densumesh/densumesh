---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

const posts = await getCollection('blog');
const sortedPosts = posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<Layout title="Blog - Dens Sumesh">
  <section class="p-2 rounded">
    <div class="flex justify-between items-center mb-2">
      <h1 class="text-xl font-normal">Blog</h1>
      <a href="/rss.xml" class="text-blue-400 hover:underline text-sm flex items-center gap-1" title="RSS Feed">
        <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24">
          <path d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248S0 22.546 0 20.752s1.456-3.248 3.252-3.248 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z"/>
        </svg>
        RSS
      </a>
    </div>
    <p>Thoughts on engineering, AI, and building distributed systems.</p>
  </section>

  <hr class="border-zinc-700 my-4 sm:hidden">

  <section class="p-2 rounded">
    {sortedPosts.length === 0 ? (
      <p>No blog posts yet. Check back soon!</p>
    ) : (
      <ul class="grid grid-cols-1 gap-4 sm:gap-6">
        {sortedPosts.map((post) => (
          <li>
            <a
              href={`/blog/${post.slug}`}
              class="block p-4 border border-zinc-700 rounded bg-zinc-900 transition-shadow hover:shadow-lg hover:border-blue-400 focus:border-blue-400 group outline-none"
              tabindex="0"
            >
              <h3 class="text-lg font-normal mb-1 text-blue-400 group-hover:text-blue-300 group-focus:text-blue-300 transition-colors">
                {post.data.title}
              </h3>
              <div class="flex items-center text-zinc-500 text-xs mb-2 gap-2">
                <svg class="w-4 h-4 inline-block mr-1 opacity-70" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2z"/></svg>
                {post.data.pubDate.toLocaleDateString('en-US', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric'
                })}
                {post.data.tags.length > 0 && (
                  <span class="ml-2">â€¢ {post.data.tags.join(', ')}</span>
                )}
              </div>
              <p class="text-zinc-300 text-sm leading-relaxed">{post.data.description}</p>
            </a>
          </li>
        ))}
      </ul>
    )}
  </section>
</Layout>
