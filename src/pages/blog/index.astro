---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

const posts = await getCollection('blog');
const sortedPosts = posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<Layout title="Blog - Dens Sumesh">
  <section class="p-2 rounded">
    <div class="flex justify-between items-center mb-2">
      <h1 class="text-xl font-normal">Blog</h1>
      <a href="/rss.xml" class="text-blue-400 hover:underline text-sm flex items-center gap-1" title="RSS Feed">
        <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24">
          <path d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248S0 22.546 0 20.752s1.456-3.248 3.252-3.248 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z"/>
        </svg>
        RSS
      </a>
    </div>
    <p>Thoughts on engineering, AI, and building distributed systems.</p>
  </section>

  <hr class="border-zinc-700 my-4 sm:hidden">

  <section class="p-2 rounded">
    {sortedPosts.length === 0 ? (
      <p>No blog posts yet. Check back soon!</p>
    ) : (
  <ul class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6">
        {sortedPosts.map((post) => (
          <li class="h-full">
            <a
              href={`/blog/${post.slug}`}
              class="flex flex-col h-full border border-zinc-700 rounded bg-zinc-900 transition-shadow hover:shadow-lg hover:border-blue-400 focus:border-blue-400 group outline-none overflow-hidden p-0"
              tabindex="0"
            >
              {post.data.heroImage && (
                <div class="p-4 pb-0">
                  <img
                    src={post.data.heroImage}
                    alt={post.data.title + ' hero image'}
                    class="w-full h-64 object-contain rounded border border-zinc-700 bg-zinc-800 shadow-sm mx-auto"
                    style={{ minHeight: '15rem', maxHeight: '15rem' }}
                    loading="lazy"
                  />
                </div>
              )}
              <div class="p-4 flex flex-col flex-1">
                <h3 class="text-lg font-normal mb-1 text-blue-400 group-hover:text-blue-300 group-focus:text-blue-300 transition-colors">
                  {post.data.title}
                </h3>
                <div class="mb-2">
                  <div class="flex items-center gap-1 text-zinc-400 text-xs mb-2">
                    <svg class="w-4 h-4 opacity-70" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2z"/></svg>
                    <span>{post.data.pubDate.toLocaleDateString('en-US', {
                      year: 'numeric',
                      month: 'short',
                      day: 'numeric'
                    })}</span>
                  </div>
                  {post.data.tags.length > 0 && (
                    <div class="flex flex-wrap gap-1">
                      {post.data.tags.map(tag => (
                        <span class="bg-zinc-800 border border-zinc-700 rounded-full px-2 py-0.5 text-zinc-300 font-mono text-[0.85em]">{tag}</span>
                      ))}
                    </div>
                  )}
                </div>
                <p class="text-zinc-300 text-sm leading-relaxed">{post.data.description}</p>
                <span class="flex-1" />
              </div>
            </a>
          </li>
        ))}
      </ul>
    )}
  </section>
</Layout>
